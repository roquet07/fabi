<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VÃ­a LÃ¡ctea PÃºrpura Â· PartÃ­culas de luz</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            background-color: black;
            font-family: 'Segoe UI', 'Arial', sans-serif;
        }
        canvas {
            display: block;
        }
        /* Estilo base de las frases (se modifica dinÃ¡micamente) */
        .cosmic-phrase {
            color: #f0eaff;
            font-weight: 500;
            letter-spacing: 1.5px;
            text-shadow: 0 0 10px #b794f4, 0 0 20px #9f7aea;
            background: rgba(10, 0, 20, 0.6);
            padding: 6px 14px;
            border-radius: 30px;
            border: 1px solid rgba(210, 180, 255, 0.5);
            backdrop-filter: blur(3px);
            white-space: nowrap;
            box-shadow: 0 0 20px rgba(128, 90, 213, 0.25);
            pointer-events: none;
            transition: transform 0.1s;
            opacity: 0; /* invisible por defecto, se activa con JS */
            font-size: 0px; /* arrancan sin tamaÃ±o */
        }
        .cosmic-phrase-short {
            font-size: 0px; /* base override, se ajusta dinÃ¡micamente */
            padding: 4px 12px;
        }
        #instructions {
            position: absolute;
            bottom: 20px;
            width: 100%;
            text-align: center;
            color: #d9c9ff;
            font-size: 12px;
            letter-spacing: 3px;
            text-transform: uppercase;
            pointer-events: none;
            opacity: 0.8;
            z-index: 100;
            text-shadow: 0 0 8px #6b46c1;
        }
    </style>
</head>
<body>
    <div id="instructions">ðŸŒŒ AcÃ©rcate a las estrellas Â· las palabras aparecerÃ¡n ðŸŒŒ</div>

    <script type="importmap">
        {
            "imports": {
                "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
                "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/"
            }
        }
    </script>

    <script type="module">
        import * as THREE from 'three';
        import { OrbitControls } from 'three/addons/controls/OrbitControls.js';
        import { CSS2DRenderer, CSS2DObject } from 'three/addons/renderers/CSS2DRenderer.js';

        // --- CONFIGURACIÃ“N INICIAL ---
        const scene = new THREE.Scene();
        scene.background = new THREE.Color(0x050510);
        const camera = new THREE.PerspectiveCamera(60, window.innerWidth / window.innerHeight, 0.1, 1000);
        camera.position.set(15, 10, 70); // PosiciÃ³n inicial alejada
        camera.lookAt(0, 0, 0);

        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
        document.body.appendChild(renderer.domElement);

        const labelRenderer = new CSS2DRenderer();
        labelRenderer.setSize(window.innerWidth, window.innerHeight);
        labelRenderer.domElement.style.position = 'absolute';
        labelRenderer.domElement.style.top = '0px';
        labelRenderer.domElement.style.left = '0px';
        labelRenderer.domElement.style.pointerEvents = 'none';
        document.body.appendChild(labelRenderer.domElement);

        const controls = new OrbitControls(camera, renderer.domElement);
        controls.enableDamping = true;
        controls.autoRotate = true;
        controls.autoRotateSpeed = 0.4;
        controls.enableZoom = true;
        controls.enablePan = true;
        controls.maxDistance = 150;
        controls.minDistance = 15;

        // --- LUCES Y NÃšCLEO ---
        const ambientLight = new THREE.AmbientLight(0x404060);
        scene.add(ambientLight);
        const pointLight = new THREE.PointLight(0xb78aff, 1.5, 100);
        pointLight.position.set(0, 0, 0);
        scene.add(pointLight);

        // NÃºcleo galÃ¡ctico
        const coreGeometry = new THREE.SphereGeometry(2.2, 32, 32);
        const coreMaterial = new THREE.MeshStandardMaterial({
            color: 0x9f7aea,
            emissive: 0x553c9a,
            emissiveIntensity: 0.8,
            roughness: 0.3,
            metalness: 0.1
        });
        const coreSphere = new THREE.Mesh(coreGeometry, coreMaterial);
        scene.add(coreSphere);

        // Halo
        const haloParticlesGeo = new THREE.BufferGeometry();
        const haloPositions = [];
        for (let i = 0; i < 600; i++) {
            const radius = 2.8 + Math.random() * 1.5;
            const theta = Math.random() * Math.PI * 2;
            const phi = Math.acos((Math.random() * 2) - 1);
            const x = radius * Math.sin(phi) * Math.cos(theta);
            const y = radius * Math.sin(phi) * Math.sin(theta);
            const z = radius * Math.cos(phi);
            haloPositions.push(x, y, z);
        }
        haloParticlesGeo.setAttribute('position', new THREE.Float32BufferAttribute(haloPositions, 3));
        const haloParticlesMat = new THREE.PointsMaterial({
            color: 0xd6b4ff,
            size: 0.15,
            transparent: true,
            blending: THREE.AdditiveBlending
        });
        const halo = new THREE.Points(haloParticlesGeo, haloParticlesMat);
        scene.add(halo);

        // --- FONDO DE ESTRELLAS ---
        const bgStarsGeo = new THREE.BufferGeometry();
        const bgStarsCount = 4000;
        const bgPositions = new Float32Array(bgStarsCount * 3);
        for (let i = 0; i < bgStarsCount * 3; i += 3) {
            bgPositions[i] = (Math.random() - 0.5) * 400;
            bgPositions[i+1] = (Math.random() - 0.5) * 400;
            bgPositions[i+2] = (Math.random() - 0.5) * 400 - 50;
        }
        bgStarsGeo.setAttribute('position', new THREE.BufferAttribute(bgPositions, 3));
        const bgStarsMat = new THREE.PointsMaterial({
            color: 0xffffff,
            size: 0.35,
            transparent: true,
            opacity: 0.6,
            blending: THREE.AdditiveBlending
        });
        const bgStars = new THREE.Points(bgStarsGeo, bgStarsMat);
        scene.add(bgStars);

        // --- GALAXIA ESPIRAL (corazones) ---
        function createHeartTexture() {
            const canvas = document.createElement('canvas');
            canvas.width = 64;
            canvas.height = 64;
            const ctx = canvas.getContext('2d');
            ctx.fillStyle = 'white';
            ctx.shadowColor = 'white';
            ctx.shadowBlur = 10;
            ctx.beginPath();
            ctx.moveTo(32, 20);
            ctx.bezierCurveTo(32, 17, 27, 10, 17, 10);
            ctx.bezierCurveTo(2, 10, 2, 28, 2, 28);
            ctx.bezierCurveTo(2, 40, 17, 52, 32, 60);
            ctx.bezierCurveTo(47, 52, 62, 40, 62, 28);
            ctx.bezierCurveTo(62, 28, 62, 10, 47, 10);
            ctx.bezierCurveTo(37, 10, 32, 17, 32, 20);
            ctx.fill();
            return new THREE.CanvasTexture(canvas);
        }

        const particleCount = 22000;
        const galaxyGeo = new THREE.BufferGeometry();
        const positions = new Float32Array(particleCount * 3);
        const colors = new Float32Array(particleCount * 3);

        const coreColor = new THREE.Color("#b197fc");
        const armColor = new THREE.Color("#d6b4ff");
        const outerColor = new THREE.Color("#9775fa");
        const extraColor = new THREE.Color("#e599f7");

        const numArms = 2;
        const armSpread = 0.55;
        const armTightness = 0.13;
        const galaxyRadius = 58;

        for (let i = 0; i < particleCount; i++) {
            const distFactor = Math.random();
            let radius = distFactor * galaxyRadius;
            if (distFactor < 0.2) radius *= (Math.random() * 0.5 + 0.5);

            const armIndex = Math.floor(Math.random() * numArms);
            const armAngleOffset = (Math.PI * 2 / numArms) * armIndex;
            const spiralAngle = radius * armTightness;
            const baseAngle = Math.random() * Math.PI * 2;
            const deviation = Math.random() * armSpread - armSpread/2;

            const x = Math.cos(baseAngle + spiralAngle + armAngleOffset + deviation) * radius;
            const z = Math.sin(baseAngle + spiralAngle + armAngleOffset + deviation) * radius;
            const y = (Math.random() - 0.5) * (radius < 12 ? 2.5 : radius / 12);

            positions[i * 3] = x;
            positions[i * 3 + 1] = y;
            positions[i * 3 + 2] = z;

            let mixColor;
            if (distFactor < 0.2) {
                mixColor = coreColor.clone().lerp(armColor, Math.random());
            } else if (distFactor < 0.6) {
                mixColor = armColor.clone().lerp(extraColor, (distFactor - 0.2) / 0.4);
            } else {
                mixColor = outerColor.clone().lerp(armColor, (distFactor - 0.6) / 0.4);
            }
            mixColor.offsetHSL((Math.random() - 0.5) * 0.1, (Math.random() - 0.5) * 0.1, (Math.random() - 0.5) * 0.1);

            colors[i * 3] = mixColor.r;
            colors[i * 3 + 1] = mixColor.g;
            colors[i * 3 + 2] = mixColor.b;
        }

        galaxyGeo.setAttribute('position', new THREE.BufferAttribute(positions, 3));
        galaxyGeo.setAttribute('color', new THREE.BufferAttribute(colors, 3));

        const galaxyMat = new THREE.PointsMaterial({
            size: 0.55,
            map: createHeartTexture(),
            vertexColors: true,
            transparent: true,
            alphaTest: 0.01,
            blending: THREE.AdditiveBlending,
            depthWrite: false
        });

        const galaxy = new THREE.Points(galaxyGeo, galaxyMat);
        scene.add(galaxy);

        // --- FRASES CÃ“SMICAS (INVISIBLES AL INICIO) ---
        const frases = [
            "Tu universo interior es infinito",
            "Iluminas cada constelaciÃ³n",
            "Eres el centro de tu propia VÃ­a LÃ¡ctea",
            "21 aÃ±os de luz cÃ³smica",
            "Brillas con propÃ³sito y gracia",
            "Cada sueÃ±o tuyo es una estrella",
            "Naciste para explorar y crear",
            "Tu esencia es pura magia estelar",
            "El cosmos celebra tu existencia",
            "Deja tu huella en el firmamento",
            "La imagen de la poesÃ­a del sol sentido",
            "Eres mÃ¡s fuerte de quien llenarÃ¡ de paz",
            "La magia estÃ¡ en el cielo",
            "El amor es la poesÃ­a de los sentidos",
            "La vida es un juego, dibuja tu paraÃ­so",
            "La magia estÃ¡ en el juego",
            "Eres mÃ¡s fuerte de lo que piensas",
            "El amor es la poesÃ­a del sol que se extiende",
            "Reiniciar para actualizar",
            "La felicidad es un viaje, una aventura, el camino",
            "La magia estÃ¡ en creer",
            "Eran mis fuerzas de la felicidad",
            "La vida es un lienzo, dibuja tu paradigma",
            "Creo en ti y todo es posible",
            "La vida es una oportunidad",
            "El amor es la misma cosa que la felicidad"
        ];

        const labelGroup = [];
        
        // ConfiguraciÃ³n del fade por distancia
        const DIST_MAX = 55;    // a partir de esta distancia son invisibles
        const DIST_MIN = 20;    // a esta distancia alcanzan tamaÃ±o completo
        
        frases.forEach((texto, i) => {
            const div = document.createElement('div');
            div.textContent = texto;
            div.className = 'cosmic-phrase';
            div.style.opacity = '0';
            div.style.fontSize = '0px';
            
            const label = new CSS2DObject(div);
            
            // PosiciÃ³n en espiral
            const angle = (i / frases.length) * Math.PI * 2;
            const spiralRadius = 32 + (i % 3) * 5 + Math.sin(i * 0.7) * 6;
            const x = Math.cos(angle) * spiralRadius;
            const z = Math.sin(angle) * spiralRadius;
            const y = Math.sin(angle * 2) * 8 + (i % 5 - 2) * 3;
            
            label.position.set(x, y, z);
            label.userData = { 
                baseY: y, 
                speed: 0.5 + Math.random() * 0.5,
                baseX: x,
                baseZ: z,
                div: div,
                baseSize: 18,      // tamaÃ±o mÃ¡ximo cuando estÃ¡ cerca
                short: false
            };
            scene.add(label);
            labelGroup.push(label);
        });

        // Frases cortas
        const frasesCortas = [
            "âœ¨ Magia âœ¨", "ðŸ’œ Amor ðŸ’œ", "ðŸŒŒ Cree en ti", "ðŸª Paz", "â­ Luz"
        ];
        frasesCortas.forEach((texto, i) => {
            const div = document.createElement('div');
            div.textContent = texto;
            div.className = 'cosmic-phrase cosmic-phrase-short';
            div.style.opacity = '0';
            div.style.fontSize = '0px';
            
            const label = new CSS2DObject(div);
            const angle = (i / frasesCortas.length) * Math.PI * 2;
            label.position.set(Math.cos(angle) * 15, Math.sin(angle * 2) * 4, Math.sin(angle) * 15);
            label.userData = {
                baseY: label.position.y,
                speed: 0.6,
                baseX: label.position.x,
                baseZ: label.position.z,
                div: div,
                baseSize: 14,      // tamaÃ±o mÃ¡ximo para frases cortas
                short: true
            };
            scene.add(label);
            labelGroup.push(label);
        });

        // --- ANIMACIÃ“N PRINCIPAL ---
        function animate() {
            requestAnimationFrame(animate);
            
            const elapsedTime = performance.now() * 0.001;
            
            // Rotaciones
            galaxy.rotation.y += 0.0002;
            galaxy.rotation.x += 0.00005;
            bgStars.rotation.y -= 0.0001;
            halo.rotation.y += 0.001;

            // --- ACTUALIZAR VISIBILIDAD DE FRASES SEGÃšN DISTANCIA ---
            labelGroup.forEach((label) => {
                if (!label.userData.div) return;
                
                // Distancia desde la cÃ¡mara a la frase
                const distance = camera.position.distanceTo(label.position);
                
                // Calcular factor de visibilidad (0 a 1)
                let factor = 1 - (distance - DIST_MIN) / (DIST_MAX - DIST_MIN);
                factor = Math.max(0, Math.min(1, factor)); // clamp entre 0 y 1
                
                // Aplicar opacidad y tamaÃ±o
                const div = label.userData.div;
                const baseSize = label.userData.baseSize || 18;
                
                // TamaÃ±o de fuente: desde 0px hasta baseSize
                const fontSize = Math.floor(factor * baseSize);
                div.style.fontSize = fontSize + 'px';
                div.style.opacity = factor * 0.95; // ligeramente menos que 1 para suavizar
                
                // AnimaciÃ³n flotante (se mantiene)
                if (label.userData.baseY !== undefined) {
                    label.position.y = label.userData.baseY + Math.sin(elapsedTime * label.userData.speed + label.id) * 1.2;
                }
                if (label.userData.baseX) {
                    label.position.x = label.userData.baseX + Math.sin(elapsedTime * 0.3 + label.id) * 0.3;
                    label.position.z = label.userData.baseZ + Math.cos(elapsedTime * 0.2 + label.id) * 0.3;
                }
            });

            controls.update();
            renderer.render(scene, camera);
            labelRenderer.render(scene, camera);
        }

        animate();

        // --- AJUSTE DE VENTANA ---
        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
            labelRenderer.setSize(window.innerWidth, window.innerHeight);
        });
    </script>
</body>
</html>